# Поиск калорийности продуктов - Документация

## Описание проекта

Приложение для поиска информации о пищевой ценности продуктов через API Open Food Facts. Позволяет находить продукты по штрихкоду или названию и отображает подробную информацию о калорийности и БЖУ (белки, жиры, углеводы).

## Архитектура приложения

### Основные модули и зависимости

import sys
import requests
from PyQt6.QtWidgets import (...)
from PyQt6.QtCore import Qt, QThread, pyqtSignal
from PyQt6.QtGui import QFont

## Классы и функции

### Класс SearchThread

Назначение: Обеспечивает асинхронное выполнение поисковых запросов

class SearchThread(QThread):
    finished = pyqtSignal(object)  # Сигнал успешного завершения
    error = pyqtSignal(str)       # Сигнал ошибки
    
    def __init__(self, search_type, query)
    def run(self)

Методы:
- __init__(self, search_type, query) - инициализация потока
- run(self) - основной метод выполнения в отдельном потоке

### Функции работы с API

#### get_product_by_barcode(barcode, fields, lang, country)
Назначение: Получение продукта по штрихкоду

Параметры:
- barcode (str) - штрихкод продукта
- fields (list) - поля для получения (по умолчанию: код, название, нутрименты и т.д.)
- lang (str) - язык интерфейса (по умолчанию: "ru")
- country (str) - страна (по умолчанию: "ru")

Возвращает: dict с данными продукта

#### search_products(query, page_size, fields, lang, country)
Назначение: Поиск продуктов по названию

Параметры:
- query (str) - поисковый запрос
- page_size (int) - количество результатов (по умолчанию: 15)
- fields (list) - поля для получения
- lang, country - региональные настройки

Возвращает: dict с списком продуктов

### Функции обработки данных

#### extract_kcal(nutriments)
Назначение: Извлечение данных о калорийности и БЖУ

Параметры:
- nutriments (dict) - словарь с нутриментами из API

Возвращает: dict с отфильтрованными данными о калориях и БЖУ на 100г и на порцию

Извлекаемые поля:
- kcal_100g, protein_100g, fat_100g, carbs_100g
- kcal_serving, protein_serving, fat_serving, carbs_serving

#### format_product_details(product)
Назначение: Форматирование информации о продукте для отображения

Параметры:
- product (dict) - данные продукта

Возвращает: str - отформатированная строка с информацией

### Класс MainWindow

Назначение: Основное окно приложения с графическим интерфейсом

#### Конструктор и инициализация
def __init__(self):
    # Настройка окна
    self.setWindowTitle("Поиск калорийности продуктов")
    self.resize(1000, 800)  # Размеры окна
    
    # Инициализация компонентов
    self.setup_ui()
    self.setup_styles()

#### Основные методы интерфейса

##### on_mode_changed(index)
Назначение: Обработчик изменения режима поиска

Параметры:
- index (int) - индекс выбранного режима

Действия:
- Очищает результаты предыдущего поиска
- Настраивает placeholder поля ввода
- Показывает/скрывает таблицу результатов

##### on_search_clicked()
Назначение: Обработчик нажатия кнопки "Найти"

Действия:
- Проверяет введенный запрос
- Блокирует UI на время поиска
- Запускает поиск в отдельном потоке
- Показывает индикатор прогресса

##### set_ui_enabled(enabled)
Назначение: Управление состоянием элементов UI

Параметры:
- enabled (bool) - включить/выключить элементы

##### handle_barcode_result(data)
Назначение: Обработка результатов поиска по штрихкоду

Параметры:
- data (dict) - данные от API

##### handle_name_result(data)
Назначение: Обработка результатов поиска по названию

Параметры:
- data (dict) - данные от API

Действия:
- Заполняет таблицу найденными продуктами
- Настраивает отображение колонок
- Обновляет статус бар

##### on_table_double_clicked(row, column)
Назначение: Обработчик двойного клика по таблице

Параметры:
- row (int) - номер строки
- column (int) - номер колонки

Действия: Отображает детальную информацию о выбранном продукте

## Элементы интерфейса
### Компоненты UI:
- QComboBox - выбор режима поиска (штрихкод/название)
- QLineEdit - поле ввода запроса
- QPushButton - кнопка "Найти"
- QTableWidget - таблица результатов (5 колонок)
- QTextEdit - область детальной информации
- QProgressBar - индикатор загрузки
- QLabel - текстовые метки и статус бар

### Структура таблицы:
1. Штрихкод - код продукта
2. Название - наименование продукта (растягиваемая колонка)
3. Бренд - производитель
4. Ккал/100г - калорийность на 100 грамм
5. Количество - информация об упаковке

## Настройки и конфигурация

### Константы API:
BASE = "https://world.openfoodfacts.org"
HEADERS = {
    "User-Agent": "Darcons-Trade-CalorieFetcher/1.0"
}

### Параметры поиска по умолчанию:
- Язык: русский (lang="ru")
- Страна: Россия (country="ru")
- Количество результатов: 15 (page_size=15)
- Таймаут запроса: 20 секунд

## Запуск приложения

### Основная функция:
def main():
    app = QApplication(sys.argv)
    app.setStyle('Fusion')
    window = MainWindow()
    window.show()
    sys.exit(app.exec())

### Точка входа:
if __name__ == "__main__":
    main()

## Особенности реализации

### Многопоточность:
- Поиск выполняется в отдельном потоке QThread
- Не блокирует пользовательский интерфейс
- Сигналы pyqtSignal для связи между потоками

### Обработка ошибок:
- Перехват исключений сетевых запросов
- Информативные сообщения об ошибках
- Восстановление UI после сбоев

### Адаптивный интерфейс:
- Автоматическое растягивание колонок таблицы
- Поддержка разных размеров экрана
- Современный стиль с CSS-like оформлением

## Примечания

- Приложение требует подключения к интернету для работы с API
- Для работы необходимо установить библиотеки: requests, PyQt6
- API Open Food Facts предоставляет бесплатный доступ к базе продуктов
